<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Example 1: Simulation-based power calculation</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Example 1: Simulation-based power calculation</h1>



<p>This vignette is adapted from <a href="https://avi-kenny.github.io/SimEngine/examples/1" target="_blank">Example 1</a> on the SimEngine website.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SimEngine)</span></code></pre></div>
<p>Calculating statistical power is a critical step in the design of experiments. For a given study design, the statistical power is defined as the probability that a hypothesis test correctly rejects the null hypothesis (assuming it is false). Sometimes, the sample size for a study is considered fixed, and interest lies in calculating power. More often, investigators want to know what sample size is needed to reject the null hypothesis at a given power level (e.g. 80% or 90%). We assume that the reader has some familiarity with statistical hypothesis testing.</p>
<p>For simple study designs (e.g. an individually randomized controlled trial with two groups), formulas exist to calculate the sample size necessary to reject the null hypothesis under certain assumptions around the distribution of your outcome, the effect size, etc. For example, in an experiment comparing means between two groups, the following formula is used to calculate the necessary sample size to reject a null hypothesis with power <span class="math inline">\(1-\beta\)</span> and type I error rate <span class="math inline">\(\alpha\)</span>, where the outcome variable has means <span class="math inline">\(\mu_0,\mu_1\)</span> and standard deviations <span class="math inline">\(\sigma_0^2,\sigma_1^2\)</span> in the two groups and <span class="math inline">\(z_{\alpha/2}\)</span> and <span class="math inline">\(z_\beta\)</span> represent quantiles of the standard normal distribution:</p>
<p><span class="math display">\[n = \frac{(z_{\alpha/2}+z_\beta)^2(\sigma_0^2+\sigma_1^2)}{(\mu_0-\mu_1)^2}\]</span></p>
<p>However, for more complex study designs or analysis plans, formulas may not exist or may be very difficult to adapt to a particular setting. In these situations, an easier approach is to conduct simulation-based power calculations. The basic idea is that you repeatedly simulate your entire experiment and calculate the proportion of experiments in which the null hypothesis is rejected; this is your estimated power. Simulating your entire experiment will typically involve generating a dataset, and then running an analysis that involves a hypothesis test. Randomness is usually introduced into the process through the dataset generation, although sometimes you will fix a population dataset and induce randomization by taking samples from that population (e.g. to simulate survey data analyses). Often, the most difficult part is to simulate a dataset that accurately reflects the nuances (e.g. the correlation structure) of your real dataset.</p>
<p>If you want to calculate sample size at a fixed power level (e.g. 90%), you can use a “guess and check” approach. With this approach, you select a sample size <span class="math inline">\(n_1\)</span> and run the simulation to estimate your power. If power is estimated to be lower than 90%, you select a new value <span class="math inline">\(n_2\)</span> that is larger than <span class="math inline">\(n_1\)</span> and run the simulation again. You repeat this procedure until the estimated power is roughly 90%.</p>
<p>We illustrate this process by simulating a randomized controlled trial and comparing our results to what we get from the formula above. We then show how our simulation can be modified to adapt to more complex scenarios.</p>
<p>First, we declare a new simulation object and write our creator function:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">new_sim</span>()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&lt;&gt;%</span> <span class="fu">add_creator</span>(<span class="st">&quot;create_rct_data&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(n, mu_0, mu_1, sigma_0, sigma_1) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    group <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),n))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    outcome <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>group) <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="at">n=</span>n, <span class="at">mean=</span>mu_0, <span class="at">sd=</span>sigma_0) <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>               group <span class="sc">*</span> <span class="fu">rnorm</span>(<span class="at">n=</span>n, <span class="at">mean=</span>mu_1, <span class="at">sd=</span>sigma_1)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="st">&quot;group&quot;</span><span class="ot">=</span>group, <span class="st">&quot;outcome&quot;</span><span class="ot">=</span>outcome))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Test our creator function</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>sim<span class="sc">$</span>creators<span class="sc">$</span><span class="fu">create_rct_data</span>(<span class="at">n=</span><span class="dv">3</span>, <span class="at">mu_0=</span><span class="dv">3</span>, <span class="at">mu_1=</span><span class="dv">4</span>, <span class="at">sigma_0=</span><span class="fl">0.1</span>, <span class="at">sigma_1=</span><span class="fl">0.1</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   group  outcome</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 4.022617</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     0 3.174777</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     1 4.036261</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     1 4.022617</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     0 3.174777</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     0 2.779289</span></span></code></pre></div>
<p>Next, we add a function that takes a dataset generated by our creator function and runs a statistical test to decide whether to reject the null hypothesis:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&lt;&gt;%</span> <span class="fu">add_method</span>(<span class="st">&quot;run_test&quot;</span>, <span class="cf">function</span>(data) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  test_result <span class="ot">&lt;-</span> <span class="fu">t.test</span>(outcome<span class="sc">~</span>group, <span class="at">data=</span>data)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.integer</span>(test_result<span class="sc">$</span>p.value<span class="sc">&lt;</span><span class="fl">0.05</span>))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>Next, we write the simulation script and tell SimEngine to run 1,000 simulation replicates each for four sample sizes.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_script</span>(<span class="cf">function</span>() {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">create_rct_data</span>(<span class="at">n=</span>L<span class="sc">$</span>n, <span class="at">mu_0=</span><span class="dv">17</span>, <span class="at">mu_1=</span><span class="dv">18</span>, <span class="at">sigma_0=</span><span class="dv">2</span>, <span class="at">sigma_1=</span><span class="dv">2</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  reject <span class="ot">&lt;-</span> <span class="fu">run_test</span>(data)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">list</span>(<span class="st">&quot;reject&quot;</span><span class="ot">=</span>reject))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_levels</span>(<span class="at">n=</span><span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">60</span>,<span class="dv">80</span>))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&lt;&gt;%</span> <span class="fu">set_config</span>(<span class="at">num_sim=</span><span class="dv">1000</span>)</span></code></pre></div>
<p>We are now ready to run the simulation. After obtaining results, we calculate power by averaging the ‘reject’ variable using the summarize() function, which tells us the percentage of simulations in which the null hypothesis was rejected.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&lt;&gt;%</span> <span class="fu">run</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Done. No errors or warnings detected.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>power_sim <span class="ot">&lt;-</span> sim <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">list</span>(<span class="at">name=</span><span class="st">&quot;power&quot;</span>, <span class="at">x=</span><span class="st">&quot;reject&quot;</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(power_sim)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   level_id  n power</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1        1 20 0.406</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2        2 40 0.583</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3        3 60 0.741</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4        4 80 0.836</span></span></code></pre></div>
<p>We can compare our results to what we obtain by using the formula stated earlier.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>power_formula <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">60</span>,<span class="dv">80</span>), <span class="cf">function</span>(n) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pnorm</span>(<span class="fu">sqrt</span>((n<span class="sc">*</span>(<span class="dv">17-18</span>)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="dv">2</span><span class="sc">^</span><span class="dv">2</span><span class="sc">+</span><span class="dv">2</span><span class="sc">^</span><span class="dv">2</span>)) <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, <span class="at">lower.tail=</span>F))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">40</span>,<span class="dv">60</span>,<span class="dv">80</span>), <span class="dv">2</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">power =</span> <span class="fu">c</span>(power_sim<span class="sc">$</span>power, power_formula),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">which =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Simulation&quot;</span>,<span class="st">&quot;Formula&quot;</span>), <span class="at">each=</span><span class="dv">4</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>), <span class="fu">aes</span>(<span class="at">x=</span>n, <span class="at">y=</span>power, <span class="at">color=</span><span class="fu">factor</span>(which))) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&quot;Method&quot;</span>, <span class="at">y=</span><span class="st">&quot;Power&quot;</span>, <span class="at">x=</span><span class="st">&quot;Sample size (per group)&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Of course, real applications will typically involve much more complex data generating mechanisms and analyses, but the code above illustrates the basic approach of simulation-based power calculation.</p>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
